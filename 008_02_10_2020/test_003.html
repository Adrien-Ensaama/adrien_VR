<html>
  <head>
    <meta charset="UTF-8">
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.0.1/dist/aframe-extras.min.js"></script>
    <script>
      AFRAME.registerComponent("tests-modèle",{
        init: function(){
          this.el.addEventListener('model-loaded', () =>{
              console.log('>>>> Le modèle de ' + this.el.id + ' est chargé.')
          });
          this.el.addEventListener('model-error', ()  =>{
            console.log('>>>> Le modèle de ' + this.el.id + " ne s'est pas chargé")
          });
        }
      })

      AFRAME.registerComponent("choregraphie", {
        update: function(){
          var nb = 0;
          var pas = 1;
          var danse;
          this.el.addEventListener('animation-loop', () =>{
            nb ++;
            console.log(">>>> " + this.el.id + " a fait " + nb + " boucle.s");
          })
          this.el.addEventListener('animation-finished', () =>{
            nb = 0;
            console.log("fin du pas " + pas);
            console.log(">>>> Tirage au sort d'un pas");
            switch (pas){
              case 0 : danse = " 'clip:pas_01_D; repetitions: 2; ";
                       pas = 1;
                       break;
              case 1 : danse = " 'clip:pas_02_D; repetitions: 2;' ";
                       pas = 2;
                       console.log(">>>> pas =  " + pas);
                       break;
              case 2 : danse = " 'clip:pas_03_D repetitions: 2;' ";
                       pas = 3;
                       console.log(">>>> pas =  " + pas);
                       break;
              case 3 : danse = " 'clip:pas_04_D; repetitions: 2;' ";
                       pas = 4;
                       console.log(">>>> pas =  " + pas);
                       break;
              case 4 : danse = " 'clip:0_stay; repetitions: 2;' ";
                       pas = 0;
                       console.log(">>>> pas =  " + pas);
                       break;
              default : break;
            }
            console.log(danse);
            this.el.setAttribute('animation-mixer', danse);
          })
        }
      })
    </script>
  </head>

  <body>

      <a-scene>
        <a-assets>
          <a-asset-item id="come"  src="./data/come_adrien.glb"></a-asset-item>
        </a-assets>

        <a-entity id="come"
                  position="0 0.5 -2.5"
                  rotation="90 90 0"
                  scale="0.7 0.7 0.7"
                  gltf-model="#come"
                  animation-mixer="clip: pas_01_D;
                                   timeScale: 1;
                                   repetitions: 3;"
                  tests-modèle
                  choregraphie
                  >
        </a-entity>

        <a-light type="ambient" color="white"></a-light>
        <a-light type="point" intensity="1" position="-2 10 -15"></a-light>
      </a-scene>

  </body>
</html>
